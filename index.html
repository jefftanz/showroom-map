<!DOCTYPE html>
<html>
  <head>
    <title>Simple Map</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBIwzALxUPNbatRBj3Xi1Uhp0fFzwWNBkE&callback=initMap&libraries=&v=weekly"
      defer
    ></script>
    <script src="location.js"></script>
    <!-- jsFiddle will insert css and js -->

    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }

      /* Optional: Makes the sample page fill the window. */
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>

  </head>
  <body>
    <div id="map"></div>
  </body>

  <script>
    let map;
    let openedInfoWindow = null;

    function initMap() {
      // { lat: 33.748, lng: -84.387 }

      console.log('length: ' + location_data.length);

      const atl = { lat: 33.748, lng: -84.387 };

      map = new google.maps.Map(document.getElementById("map"), 	{
        center: atl,
        zoom: 8,
      });
      
      loadData();
      
    }

    function loadData(){

      console.log('length: ' + location_data.length);

      for (let x = 0; x < location_data.length; x++){

        const name = `<div id="content">${location_data[x].LOCATION}</div>`;
        const url = `<div><a href="${location_data[x].URL}" target="_blank">View Virtual Tour</a></div>`
        const showUrl = (location_data[x].SHOW === 'Y');

        let contentString = name;
        let icon = "http://maps.google.com/mapfiles/ms/icons/red-dot.png";

        if (showUrl){
          contentString+= url;
          icon = "http://maps.google.com/mapfiles/ms/icons/blue-dot.png"
        }
      
        const infoWindow = new google.maps.InfoWindow({
          content: contentString
        });

        const lat = parseFloat(location_data[x].LAT);
        const lng = parseFloat(location_data[x].LNG);
        
        const marker = new google.maps.Marker({
          position: { lat: lat, lng: lng },
          map,
          icon: icon,
          title: location_data[x].LOCATION
        });
        
        marker.addListener("click", () => {
          if (openedInfoWindow !== null){
            openedInfoWindow.close();
            openedInfoWindow = null;
          }

          openedInfoWindow = infoWindow;
          infoWindow.open(map, marker);
        });
        
        map.addListener("click", () =>{
          if (openedInfoWindow !== null){
            openedInfoWindow.close();
            openedInfoWindow = null;
          }
        });

      }

    }

  </script>
</html>